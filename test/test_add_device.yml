---

- hosts: storage

  tasks:

  #- name: build the ring by delegating to proxy
  #  swift_ring_builder_add: disks=3 region={{ region }} hostname={{ inventory_hostname }} zone={{ zone }}
  #  delegate_to: "{{ item }}"
  #  with_items: groups.proxy


  # swift-ring-builder account.builder add z1-192.168.222.71:6002/sdb1 100
  - name: build the ring by delegating to proxy
    shell: chdir=/etc/swift swift-ring-builder account.builder add r{{ region }}z{{zone}}-{{ inventory_hostname }}:6002/1 100
    delegate_to: "{{ item }}"
    with_items: groups.proxy

  - name: build the ring by delegating to proxy
    shell: chdir=/etc/swift swift-ring-builder container.builder add r{{ region }}z{{zone}}-{{ inventory_hostname }}:6001/1 100
    delegate_to: "{{ item }}"
    with_items: groups.proxy

  - name: build the ring by delegating to proxy
    shell: chdir=/etc/swift swift-ring-builder object.builder add r{{ region }}z{{zone}}-{{ inventory_hostname }}:6000/1 100
    delegate_to: "{{ item }}"
    with_items: groups.proxy

  - name: restart swift-storage node services
    service: name=swift-{{ item }} state=restarted
    with_items:
      - object 
      - object-replicator
      - object-updater 
      - object
      - container 
      - container-replicator 
      - container-updater
      - container-auditor
      - account
      - account-replicator
      - account-reaper
      - account-auditor